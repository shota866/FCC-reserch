<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>A-Frame Car Red</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- A-Frame 本体 -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- 車を赤に塗る・汎用コンポーネント -->
    <script>
      // 使い方: <a-entity gltf-model="#carModel" recolor="color: #e60033; removeTex: true"></a-entity>
      AFRAME.registerComponent('recolor', {
        schema: {
          color: { default: '#ff0000' },   // 目標色
          only: { default: '' },           // 名前にこの文字列を含むメッシュだけを対象（空なら全て）
          exclude: { default: '' },        // 逆に除外したいメッシュ名の一部
          removeTex: { default: true }     // テクスチャを無効化（true推奨：純色にする）
        },
        init() {
          this.el.addEventListener('model-loaded', () => {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) return;
            mesh.traverse((o) => {
              if (!o.isMesh || !o.material) return;
              const name = (o.name || o.material.name || '');
              if (this.data.only && !name.includes(this.data.only)) return;
              if (this.data.exclude && name.includes(this.data.exclude)) return;
              // 純色にしたい場合はテクスチャを外す（map が残ると色が乗っても見た目が変わりにくい）
              if (this.data.removeTex) {
                o.material.map = null;
                o.material.emissiveMap = null;
                o.material.normalMap = null;
                o.material.roughnessMap = null;
                o.material.metalnessMap = null;
              }
              if (o.material.color) o.material.color.set(this.data.color);
              o.material.needsUpdate = true;
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <a-scene>
      <!-- アセット（車モデル） -->
      <a-assets>
        <a-asset-item id="carModel" src="assets/kenney_car-kit/Models/GLB format/sedan.glb"></a-asset-item>
      </a-assets>

      <!-- ライト（真っ黒対策） -->
      <a-entity light="type: ambient; intensity: 0.6"></a-entity>
      <a-entity light="type: directional; intensity: 1.0" position="1 3 2"></a-entity>

      <!-- カメラ -->
      <a-entity camera look-controls wasd-controls position="0 1.6 4"></a-entity>

      <!-- 地面と空 -->
      <a-plane rotation="-90 0 0" width="50" height="50" color="#cccccc"></a-plane>
      <a-sky color="#ECECEC"></a-sky>

      <!-- 車本体：ここで recolor を指定（#e60033 は少し深い赤） -->
      <a-entity id="car"
        gltf-model="#carModel"
        position="0 0 -4"
        rotation="0 180 0"
        scale="1 1 1"
      </a-entity>
    </a-scene>
  </body>
</html>
